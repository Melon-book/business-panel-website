import{j as e,C as P,P as N,u as G}from"./index-BbxOhHFI.js";import{a as p}from"./vendor-39lPmIfa.js";import{a as J,u as K}from"./redux-B4nc4lEw.js";import{a as h,b as g,c as y}from"./index.esm-BfaSJJoF.js";import{d as D,g as Q,C as A,B as W,D as X,E as Y,F as T,s as ee,H as se,i as ae,j as re,k as ie,l as le,J as ne,K as te,L as oe,M as ce}from"./DefaultLayout-CNXxNB8A.js";import{a as de,b as L,c as M,d as I}from"./cil-user-2Chx0D6f.js";import{b as j,c as n,a as F}from"./CRow-DRWLq7Bg.js";import{C as w,a as me,b as he,c as B,d as x,e as xe,f as C}from"./CTable-Cd597Jdk.js";import{C as Ce}from"./CCardHeader-CqZYF_dw.js";import{C as je}from"./CInputGroup-DwtM3Mdf.js";import{C as pe}from"./CInputGroupText-CFTe340s.js";import{c as ue}from"./cil-options-sHCm5Gxk.js";var fe=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M425.706,86.294A240,240,0,0,0,86.294,425.705,240,240,0,0,0,425.706,86.294ZM256,48A207.1,207.1,0,0,1,391.528,98.345L98.345,391.528A207.1,207.1,0,0,1,48,256C48,141.309,141.309,48,256,48Zm0,416a207.084,207.084,0,0,1-134.986-49.887l293.1-293.1A207.084,207.084,0,0,1,464,256C464,370.691,370.691,464,256,464Z' class='ci-primary'/>"],_e=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M426.072,86.928A238.75,238.75,0,0,0,88.428,424.572,238.75,238.75,0,0,0,426.072,86.928ZM257.25,462.5c-114,0-206.75-92.748-206.75-206.75S143.248,49,257.25,49,464,141.748,464,255.75,371.252,462.5,257.25,462.5Z' class='ci-primary'/><polygon fill='var(--ci-primary-color, currentColor)' points='221.27 305.808 147.857 232.396 125.23 255.023 221.27 351.063 388.77 183.564 366.142 160.937 221.27 305.808' class='ci-primary'/>"],be=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M479.6,399.716l-81.084-81.084-62.368-25.767A175.014,175.014,0,0,0,368,192c0-97.047-78.953-176-176-176S16,94.953,16,192,94.953,368,192,368a175.034,175.034,0,0,0,101.619-32.377l25.7,62.2L400.4,478.911a56,56,0,1,0,79.2-79.195ZM48,192c0-79.4,64.6-144,144-144s144,64.6,144,144S271.4,336,192,336,48,271.4,48,192ZM456.971,456.284a24.028,24.028,0,0,1-33.942,0l-76.572-76.572-23.894-57.835L380.4,345.771l76.573,76.572A24.028,24.028,0,0,1,456.971,456.284Z' class='ci-primary'/>"],ye=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M208,16A112.127,112.127,0,0,0,96,128v79.681a80.236,80.236,0,0,0,9.768,38.308l27.455,50.333L60.4,343.656A79.725,79.725,0,0,0,24,410.732V496H312V464H56V410.732a47.836,47.836,0,0,1,21.841-40.246l97.66-63.479-41.64-76.341A48.146,48.146,0,0,1,128,207.681V128a80,80,0,0,1,160,0v79.681a48.146,48.146,0,0,1-5.861,22.985L240.5,307.007,312,353.483V315.317l-29.223-19,27.455-50.334A80.23,80.23,0,0,0,320,207.681V128A112.127,112.127,0,0,0,208,16Z' class='ci-primary'/><polygon fill='var(--ci-primary-color, currentColor)' points='424 400 424 336 392 336 392 400 328 400 328 432 392 432 392 496 424 496 424 432 488 432 488 400 424 400' class='ci-primary'/>"];const ge=(a,c)=>{const u="example.com",r=Date.now();return`${a.toLowerCase()}.${c.toLowerCase()}.${r}@${u}`},Ne={first_name:"John",last_name:"Doe",email:ge("John","Doe"),phone:"",date_of_birth:"1990-01-01",notes:"",allergies:"",email_notifications:!0,sms_notifications:!0,marketing_emails:!0},R=({client:a,onSubmit:c,onCancel:u,loading:r,error:f})=>{const[l,v]=p.useState(Ne);p.useEffect(()=>{a&&v({first_name:a.first_name||"",last_name:a.last_name||"",email:a.email||"",phone:a.phone||"",date_of_birth:a.date_of_birth||"",notes:a.notes||"",allergies:a.allergies||"",email_notifications:a.email_notifications??!0,sms_notifications:a.sms_notifications??!0,marketing_emails:a.marketing_emails??!0})},[a]);const i=_=>{const{name:S,value:E,type:k,checked:b}=_.target;v(m=>({...m,[S]:k==="checkbox"?b:E}))},d=_=>{_.preventDefault(),c(l)};return e.jsxs(de,{onSubmit:d,children:[f&&e.jsx(L,{color:"danger",className:"mb-3",children:f}),e.jsxs(j,{className:"mb-3",children:[e.jsxs(n,{md:6,children:[e.jsx(h,{htmlFor:"first_name",children:"First Name *"}),e.jsx(g,{id:"first_name",name:"first_name",value:l.first_name,onChange:i,required:!0,disabled:r})]}),e.jsxs(n,{md:6,children:[e.jsx(h,{htmlFor:"last_name",children:"Last Name *"}),e.jsx(g,{id:"last_name",name:"last_name",value:l.last_name,onChange:i,required:!0,disabled:r})]})]}),e.jsxs(j,{className:"mb-3",children:[e.jsxs(n,{md:6,children:[e.jsx(h,{htmlFor:"email",children:"Email"}),e.jsx(g,{id:"email",name:"email",type:"email",value:l.email,onChange:i,disabled:r})]}),e.jsxs(n,{md:6,children:[e.jsx(h,{htmlFor:"phone",children:"Phone"}),e.jsx(g,{id:"phone",name:"phone",type:"tel",value:l.phone,onChange:i,disabled:r})]})]}),e.jsx(j,{className:"mb-3",children:e.jsxs(n,{md:6,children:[e.jsx(h,{htmlFor:"date_of_birth",children:"Date of Birth"}),e.jsx(g,{id:"date_of_birth",name:"date_of_birth",type:"date",value:l.date_of_birth,onChange:i,disabled:r})]})}),e.jsx(j,{className:"mb-3",children:e.jsxs(n,{children:[e.jsx(h,{htmlFor:"notes",children:"Notes"}),e.jsx(D,{id:"notes",name:"notes",rows:"3",value:l.notes,onChange:i,disabled:r})]})}),e.jsx(j,{className:"mb-3",children:e.jsxs(n,{children:[e.jsx(h,{htmlFor:"allergies",children:"Allergies"}),e.jsx(D,{id:"allergies",name:"allergies",rows:"2",value:l.allergies,onChange:i,disabled:r})]})}),e.jsxs(j,{className:"mb-3",children:[e.jsx(n,{children:e.jsx(w,{id:"email_notifications",name:"email_notifications",label:"Email Notifications",checked:l.email_notifications,onChange:i,disabled:r})}),e.jsx(n,{children:e.jsx(w,{id:"sms_notifications",name:"sms_notifications",label:"SMS Notifications",checked:l.sms_notifications,onChange:i,disabled:r})}),e.jsx(n,{children:e.jsx(w,{id:"marketing_emails",name:"marketing_emails",label:"Marketing Emails",checked:l.marketing_emails,onChange:i,disabled:r})})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx(F,{color:"secondary",onClick:u,disabled:r,children:"Cancel"}),e.jsx(F,{color:"primary",type:"submit",disabled:r,children:r?e.jsxs(e.Fragment,{children:[e.jsx(P,{size:"sm",className:"me-2"}),"Saving..."]}):a?"Update Client":"Add Client"})]})]})};R.propTypes={client:N.object,onSubmit:N.func.isRequired,onCancel:N.func.isRequired,loading:N.bool,error:N.string};const Be=()=>{const a=J(),{business:c}=G(),{clients:u,loading:r,error:f,filters:l}=K(s=>s.clients),[v,i]=p.useState(!1),[d,_]=p.useState(null),[S,E]=p.useState(!1),[k,b]=p.useState(null),m=c==null?void 0:c.id;p.useEffect(()=>{m&&Z()},[m,l]);const Z=async()=>{a({type:"CLIENTS_LOADING"});const{data:s,error:t}=await Q(m,l);a(t?{type:"CLIENTS_ERROR",payload:t}:{type:"CLIENTS_SUCCESS",payload:s||[]})},H=s=>{a({type:"SET_CLIENT_FILTERS",payload:{search:s.target.value}})},V=()=>{_(null),b(null),i(!0)},O=s=>{_(s),b(null),i(!0)},U=async s=>{if(window.confirm("Are you sure you want to delete this client?")){const{error:t}=await te(s);t?alert("Error deleting client: "+t):a({type:"REMOVE_CLIENT",payload:s})}},$=async s=>{const{data:t,error:o}=await ne(s.id,!s.is_blocked);o?alert("Error updating client: "+o):a({type:"UPDATE_CLIENT",payload:t})},q=async s=>{E(!0),b(null);const t={...s,business_id:m};let o;d?o=await oe(d.id,t):o=await ce(t),E(!1),o.error?b(o.error):(a(d?{type:"UPDATE_CLIENT",payload:o.data}:{type:"ADD_CLIENT",payload:o.data}),i(!1))},z=s=>s||"-";return m?e.jsxs(e.Fragment,{children:[e.jsxs(M,{className:"mb-4",children:[e.jsxs(Ce,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("strong",{children:"Clients"}),e.jsxs(F,{color:"primary",onClick:V,children:[e.jsx(y,{icon:ye,className:"me-2"}),"Add Client"]})]}),e.jsxs(I,{children:[e.jsx(j,{className:"mb-3",children:e.jsx(n,{md:6,children:e.jsxs(je,{children:[e.jsx(pe,{children:e.jsx(y,{icon:be})}),e.jsx(g,{placeholder:"Search clients...",value:l.search,onChange:H})]})})}),f&&e.jsx(L,{color:"danger",className:"mb-3",children:f}),r?e.jsx("div",{className:"text-center py-5",children:e.jsx(P,{color:"primary"})}):u.length===0?e.jsx("div",{className:"text-center py-5 text-muted",children:"No clients found. Add your first client to get started."}):e.jsxs(me,{hover:!0,responsive:!0,children:[e.jsx(he,{children:e.jsxs(B,{children:[e.jsx(x,{children:"Name"}),e.jsx(x,{children:"Email"}),e.jsx(x,{children:"Phone"}),e.jsx(x,{children:"Bookings"}),e.jsx(x,{children:"Total Spent"}),e.jsx(x,{children:"Status"}),e.jsx(x,{children:"Actions"})]})}),e.jsx(xe,{children:u.map(s=>e.jsxs(B,{children:[e.jsx(C,{children:e.jsxs("strong",{children:[s.first_name," ",s.last_name]})}),e.jsx(C,{children:s.email||"-"}),e.jsx(C,{children:z(s.phone)}),e.jsx(C,{children:s.total_bookings||0}),e.jsx(C,{children:s.total_spent?`${s.total_spent.toFixed(2)} PLN`:"0.00 PLN"}),e.jsx(C,{children:s.is_blocked?e.jsx(A,{color:"danger",children:"Blocked"}):s.is_active?e.jsx(A,{color:"success",children:"Active"}):e.jsx(A,{color:"secondary",children:"Inactive"})}),e.jsx(C,{children:e.jsxs(W,{children:[e.jsx(X,{color:"light",size:"sm",children:e.jsx(y,{icon:ue})}),e.jsxs(Y,{children:[e.jsxs(T,{onClick:()=>O(s),children:[e.jsx(y,{icon:ee,className:"me-2"}),"Edit"]}),e.jsxs(T,{onClick:()=>$(s),children:[e.jsx(y,{icon:s.is_blocked?_e:fe,className:"me-2"}),s.is_blocked?"Unblock":"Block"]}),e.jsxs(T,{className:"text-danger",onClick:()=>U(s.id),children:[e.jsx(y,{icon:se,className:"me-2"}),"Delete"]})]})]})})]},s.id))})]})]})]}),e.jsxs(ae,{visible:v,onClose:()=>i(!1),size:"lg",children:[e.jsx(re,{children:e.jsx(ie,{children:d?"Edit Client":"Add New Client"})}),e.jsx(le,{children:e.jsx(R,{client:d,onSubmit:q,onCancel:()=>i(!1),loading:S,error:k})})]})]}):e.jsx(M,{children:e.jsx(I,{children:e.jsx(L,{color:"warning",children:"No business found. Please ensure you are logged in with a business account."})})})};export{Be as default};
