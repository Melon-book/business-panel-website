import{u as H,r as u,j as e,C as V,h as K,i as W}from"./index-Bd778Qe4.js";import{c as f,a as p,b as C}from"./index.esm-DxxmU9r2.js";import{a as X,c as L,d as $,N as Y,O as Z,b as ee,P as ae,h as se,B as ne,D as oe,E as ie,F as G,s as le,H as re,C as B,Q as te}from"./DefaultLayout-m3DlwxqB.js";import{b as _,c as l,a as v}from"./CRow-5hfcp1sd.js";import{c as U,d as J,b as q,a as de}from"./cil-user-xxyo0guq.js";import{C as Q}from"./CCardHeader-LaoSSsrI.js";import{c as ce,a as me}from"./cil-save-CuPF9_Mc.js";import{C as w,a as ue,b as he,c as O,d as b,e as xe,f as g}from"./CTable-D8RY3rq0.js";import{C as pe}from"./CInputGroup-DKqn44tN.js";import{c as _e}from"./cil-options-sHCm5Gxk.js";const je=({service:a,categories:h,onClose:F,onSuccess:R})=>{const{business:r}=H(),[y,j]=u.useState(!1),[A,m]=u.useState(""),[S,I]=u.useState([]),[E,D]=u.useState(!0),[n,k]=u.useState({name:(a==null?void 0:a.name)||"",description:(a==null?void 0:a.description)||"",category_id:(a==null?void 0:a.category_id)||"",price:(a==null?void 0:a.price)||"",duration_minutes:(a==null?void 0:a.duration_minutes)||"",buffer_time_minutes:(a==null?void 0:a.buffer_time_minutes)||0,is_active:(a==null?void 0:a.is_active)!==void 0?a.is_active:!0,is_bookable_online:(a==null?void 0:a.is_bookable_online)!==void 0?a.is_bookable_online:!0,max_advance_booking_days:(a==null?void 0:a.max_advance_booking_days)||30,requires_consultation:(a==null?void 0:a.requires_consultation)||!1,allows_group_booking:(a==null?void 0:a.allows_group_booking)||!1,max_group_size:(a==null?void 0:a.max_group_size)||1,post_booking_message:(a==null?void 0:a.post_booking_message)||"",employee_ids:[]});u.useEffect(()=>{N()},[r==null?void 0:r.id]),u.useEffect(()=>{if(a!=null&&a.employee_services){const o=a.employee_services.map(i=>i.employee_id);k(i=>({...i,employee_ids:o}))}},[a]);const N=async()=>{if(r!=null&&r.id){D(!0);try{const{data:o,error:i}=await X(r.id,{status:"active"});if(i)console.error("Error loading employees:",i);else{const c=(o||[]).filter(x=>x.role==="junior_employee"||x.role==="senior_employee");I(c)}}catch(o){console.error("Error loading employees:",o)}finally{D(!1)}}},t=o=>{const{name:i,value:c,type:x,checked:s}=o.target;k(d=>({...d,[i]:x==="checkbox"?s:c}))},P=o=>{k(i=>{const c=i.employee_ids.includes(o)?i.employee_ids.filter(x=>x!==o):[...i.employee_ids,o];return{...i,employee_ids:c}})},T=()=>n.name.trim()?!n.price||n.price<=0?(m("Please enter a valid price"),!1):!n.duration_minutes||n.duration_minutes<=0?(m("Please enter a valid duration"),!1):!0:(m("Service name is required"),!1),z=async o=>{if(o.preventDefault(),m(""),!!T()){j(!0);try{const i={...n,business_id:r.id,price:parseFloat(n.price),duration_minutes:parseInt(n.duration_minutes),buffer_time_minutes:parseInt(n.buffer_time_minutes),max_advance_booking_days:parseInt(n.max_advance_booking_days),max_group_size:parseInt(n.max_group_size),category_id:n.category_id||null,currency:(r==null?void 0:r.currency)||"PLN"};let c;a?c=await Y(a.id,i):c=await Z(i),c.error?m(c.error):R(c.data)}catch(i){m(i.message||"An error occurred")}finally{j(!1)}}};return e.jsx(_,{children:e.jsx(l,{xs:12,children:e.jsxs(U,{className:"mb-4",children:[e.jsx(Q,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h4",{className:"mb-0",children:a?"Edit Service":"Add New Service"}),e.jsxs(v,{color:"secondary",variant:"ghost",onClick:F,children:[e.jsx(f,{icon:ce,className:"me-2"}),"Back"]})]})}),e.jsxs(J,{children:[A&&e.jsx(q,{color:"danger",dismissible:!0,onClose:()=>m(""),children:A}),e.jsxs(de,{onSubmit:z,children:[e.jsxs(_,{className:"mb-3",children:[e.jsxs(l,{md:8,children:[e.jsx(p,{htmlFor:"name",children:"Service Name *"}),e.jsx(C,{type:"text",id:"name",name:"name",value:n.name,onChange:t,required:!0})]}),e.jsxs(l,{md:4,children:[e.jsx(p,{htmlFor:"category_id",children:"Category"}),e.jsxs(L,{id:"category_id",name:"category_id",value:n.category_id,onChange:t,children:[e.jsx("option",{value:"",children:"Select Category"}),h.map(o=>e.jsx("option",{value:o.id,children:o.name},o.id))]})]})]}),e.jsx(_,{className:"mb-3",children:e.jsxs(l,{xs:12,children:[e.jsx(p,{htmlFor:"description",children:"Description"}),e.jsx($,{id:"description",name:"description",rows:"3",value:n.description,onChange:t})]})}),e.jsxs(_,{className:"mb-3",children:[e.jsxs(l,{md:3,children:[e.jsxs(p,{htmlFor:"price",children:["Price (",(r==null?void 0:r.currency)||"PLN",") *"]}),e.jsx(C,{type:"number",id:"price",name:"price",step:"0.01",min:"0",value:n.price,onChange:t,required:!0})]}),e.jsxs(l,{md:3,children:[e.jsx(p,{htmlFor:"duration_minutes",children:"Duration (minutes) *"}),e.jsx(C,{type:"number",id:"duration_minutes",name:"duration_minutes",min:"1",value:n.duration_minutes,onChange:t,required:!0})]}),e.jsxs(l,{md:3,children:[e.jsx(p,{htmlFor:"buffer_time_minutes",children:"Buffer Time (minutes)"}),e.jsx(C,{type:"number",id:"buffer_time_minutes",name:"buffer_time_minutes",min:"0",value:n.buffer_time_minutes,onChange:t})]}),e.jsxs(l,{md:3,children:[e.jsx(p,{htmlFor:"max_advance_booking_days",children:"Max Advance Booking (days)"}),e.jsx(C,{type:"number",id:"max_advance_booking_days",name:"max_advance_booking_days",min:"1",value:n.max_advance_booking_days,onChange:t})]})]}),e.jsx(_,{className:"mb-3",children:e.jsxs(l,{xs:12,children:[e.jsx(p,{htmlFor:"post_booking_message",children:"Post-Booking Message"}),e.jsx($,{id:"post_booking_message",name:"post_booking_message",rows:"3",value:n.post_booking_message,onChange:t,placeholder:"Message to send to client after booking (optional)"})]})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{children:"Assign Employees"}),E?e.jsx("div",{className:"text-center py-4",children:e.jsx(V,{})}):S.length===0?e.jsx(q,{color:"info",children:"No employees available. Only junior and senior employees can be assigned to services."}):e.jsx("div",{className:"border rounded p-3",children:S.map(o=>e.jsx(w,{id:`employee-${o.id}`,checked:n.employee_ids.includes(o.id),onChange:()=>P(o.id),label:`${o.first_name} ${o.last_name} (${o.role==="senior_employee"?"Senior":"Junior"} Employee)`,disabled:y,className:"mb-2"},o.id))})]}),e.jsxs(_,{className:"mb-3",children:[e.jsx(l,{md:4,children:e.jsx(w,{id:"is_active",name:"is_active",label:"Active",checked:n.is_active,onChange:t})}),e.jsx(l,{md:4,children:e.jsx(w,{id:"is_bookable_online",name:"is_bookable_online",label:"Bookable Online",checked:n.is_bookable_online,onChange:t})})]}),e.jsxs(_,{className:"mb-3",children:[e.jsx(l,{md:4,children:e.jsx(w,{id:"requires_consultation",name:"requires_consultation",label:"Requires Consultation",checked:n.requires_consultation,onChange:t})}),e.jsx(l,{md:4,children:e.jsx(w,{id:"allows_group_booking",name:"allows_group_booking",label:"Allow Group Booking",checked:n.allows_group_booking,onChange:t})}),n.allows_group_booking&&e.jsxs(l,{md:4,children:[e.jsx(p,{htmlFor:"max_group_size",children:"Max Group Size"}),e.jsx(C,{type:"number",id:"max_group_size",name:"max_group_size",min:"1",value:n.max_group_size,onChange:t})]})]}),e.jsxs("div",{className:"d-grid gap-2 d-md-flex justify-content-md-end",children:[e.jsx(v,{type:"button",color:"secondary",onClick:F,disabled:y,children:"Cancel"}),e.jsx(v,{type:"submit",color:"primary",disabled:y,children:y?e.jsxs(e.Fragment,{children:[e.jsx(V,{size:"sm",className:"me-2"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(f,{icon:me,className:"me-2"}),a?"Update Service":"Create Service"]})})]})]})]})]})})})},Fe=()=>{const a=K(),{business:h}=H(),{services:F,categories:R,loading:r,error:y,filters:j}=W(s=>s.services),[A,m]=u.useState(!1),[S,I]=u.useState(null),[E,D]=u.useState("");u.useEffect(()=>{h!=null&&h.id&&(n(),k())},[h==null?void 0:h.id,j]);const n=async()=>{a({type:"SERVICES_LOADING"});try{const{data:s,error:d}=await ee(h.id,j);a(d?{type:"SERVICES_ERROR",payload:d}:{type:"SERVICES_SUCCESS",payload:s||[]})}catch(s){a({type:"SERVICES_ERROR",payload:s.message})}},k=async()=>{try{const{data:s,error:d}=await ae();!d&&s&&a({type:"CATEGORIES_SUCCESS",payload:s})}catch(s){console.error("Failed to load categories:",s)}},N=(s,d)=>{a({type:"SET_SERVICE_FILTERS",payload:{[s]:d}})},t=s=>{I(s),m(!0)},P=async s=>{if(window.confirm("Are you sure you want to delete this service?"))try{const{error:d}=await te(s);a(d?{type:"SERVICES_ERROR",payload:d}:{type:"REMOVE_SERVICE",payload:s})}catch(d){a({type:"SERVICES_ERROR",payload:d.message})}},T=()=>{m(!1),I(null)},z=s=>{a(S?{type:"UPDATE_SERVICE",payload:s}:{type:"ADD_SERVICE",payload:s}),T()},o=s=>s?e.jsx(B,{color:"success",children:"Active"}):e.jsx(B,{color:"secondary",children:"Inactive"}),i=s=>s?e.jsx(B,{color:"info",children:"Bookable"}):e.jsx(B,{color:"warning",children:"Not Bookable"}),c=s=>!s.employee_services||s.employee_services.length===0?"No employees assigned":s.employee_services.map(M=>`${M.employees.first_name} ${M.employees.last_name}`).join(", "),x=F.filter(s=>s.name.toLowerCase().includes(E.toLowerCase())||s.description&&s.description.toLowerCase().includes(E.toLowerCase()));return A?e.jsx(je,{service:S,categories:R,onClose:T,onSuccess:z}):e.jsx(_,{children:e.jsx(l,{xs:12,children:e.jsxs(U,{className:"mb-4",children:[e.jsx(Q,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h4",{className:"mb-0",children:"Services Management"}),e.jsxs(v,{color:"primary",onClick:()=>m(!0),children:[e.jsx(f,{icon:se,className:"me-2"}),"Add Service"]})]})}),e.jsxs(J,{children:[y&&e.jsx(q,{color:"danger",dismissible:!0,children:y}),e.jsxs(_,{className:"mb-3",children:[e.jsx(l,{md:4,children:e.jsx(pe,{children:e.jsx(C,{placeholder:"Search services...",value:E,onChange:s=>D(s.target.value)})})}),e.jsx(l,{md:3,children:e.jsxs(L,{value:j.category,onChange:s=>N("category",s.target.value),children:[e.jsx("option",{value:"all",children:"All Categories"}),R.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})}),e.jsx(l,{md:2,children:e.jsxs(L,{value:j.status,onChange:s=>N("status",s.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})}),e.jsx(l,{md:3,children:e.jsxs(L,{value:j.availability,onChange:s=>N("availability",s.target.value),children:[e.jsx("option",{value:"all",children:"All Availability"}),e.jsx("option",{value:"bookable",children:"Bookable"}),e.jsx("option",{value:"not_bookable",children:"Not Bookable"})]})})]}),r?e.jsx("div",{className:"text-center p-4",children:e.jsx(V,{})}):e.jsxs(ue,{hover:!0,responsive:!0,children:[e.jsx(he,{children:e.jsxs(O,{children:[e.jsx(b,{children:"Name"}),e.jsx(b,{children:"Price"}),e.jsx(b,{children:"Duration"}),e.jsx(b,{children:"Assigned Employees"}),e.jsx(b,{children:"Status"}),e.jsx(b,{children:"Availability"}),e.jsx(b,{children:"Actions"})]})}),e.jsx(xe,{children:x.length===0?e.jsx(O,{children:e.jsx(g,{colSpan:"7",className:"text-center",children:"No services found"})}):x.map(s=>e.jsxs(O,{children:[e.jsxs(g,{children:[e.jsx("strong",{children:s.name}),s.description&&e.jsxs("div",{className:"small text-muted",children:[s.description.substring(0,60),"..."]})]}),e.jsxs(g,{children:[s.price," ",s.currency||"PLN"]}),e.jsxs(g,{children:[s.duration_minutes," min"]}),e.jsx(g,{children:e.jsx("small",{children:c(s)})}),e.jsx(g,{children:o(s.is_active)}),e.jsx(g,{children:i(s.is_bookable_online)}),e.jsx(g,{children:e.jsxs(ne,{children:[e.jsx(oe,{size:"sm",color:"ghost",children:e.jsx(f,{icon:_e})}),e.jsxs(ie,{children:[e.jsxs(G,{onClick:()=>t(s),children:[e.jsx(f,{icon:le,className:"me-2"}),"Edit"]}),e.jsxs(G,{onClick:()=>P(s.id),children:[e.jsx(f,{icon:re,className:"me-2"}),"Delete"]})]})]})})]},s.id))})]})]})]})})})};export{Fe as default};
