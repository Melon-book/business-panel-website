import{j as s,C as u,N as C}from"./index-BCkWgzQb.js";import{j as H,u as M,a as i}from"./vendor-CMvHcHbC.js";import{c as m,a as I,b as y}from"./index.esm-CCPNyHGR.js";import{v as U,a as V}from"./staff-DDlcHXIU.js";import{u as G}from"./useLocale-DrialdEC.js";import{d as x,b as h,c as f,a as P}from"./CRow-D1-3sYH3.js";import{c as S,d as k,b as J,a as K}from"./CForm-CpmwTKZX.js";import{c as O}from"./cil-check-circle-BlU9eaow.js";import{C as Q}from"./CCardHeader-Dyhz8jtB.js";import{c as W}from"./cil-user-Ddrdy7PS.js";import{c as F}from"./cil-lock-locked-DmxpJbVL.js";import"./redux-IAqEd8mO.js";const os=()=>{var N,b;const j=H(),v=M(),{t:e}=G(),[o,g]=i.useState(!1),[A,l]=i.useState(!0),[p,n]=i.useState(""),[L,E]=i.useState(!1),[T,_]=i.useState(""),[a,z]=i.useState(null),[c,D]=i.useState({password:"",confirmPassword:""});i.useEffect(()=>{const t=new URLSearchParams(v.search).get("token");if(!t){n(e("acceptInvitation.errors.noToken")),l(!1);return}_(t),R(t)},[v]);const R=async r=>{try{const{data:t,error:d}=await U(r);if(d){n(d),l(!1);return}z(t),l(!1)}catch{n(e("acceptInvitation.errors.verificationFailed")),l(!1)}},q=()=>!c.password||c.password.length<8?(n(e("acceptInvitation.errors.passwordMinLength")),!1):c.password!==c.confirmPassword?(n(e("acceptInvitation.errors.passwordMismatch")),!1):!0,B=async r=>{if(r.preventDefault(),n(""),!!q()){g(!0);try{const{error:t}=await V(T,a.email,c.password,a.first_name,a.last_name);if(t)throw new Error(t);E(!0),setTimeout(()=>{j(C.login)},3e3)}catch(t){n(t.message||e("acceptInvitation.errors.registrationFailed"))}finally{g(!1)}}},w=(r,t)=>{D(d=>({...d,[r]:t}))};return A?s.jsx("div",{className:"bg-light min-vh-100 d-flex flex-row align-items-center",children:s.jsx(x,{children:s.jsx(h,{className:"justify-content-center",children:s.jsx(f,{md:6,children:s.jsxs("div",{className:"text-center",children:[s.jsx(u,{color:"primary"}),s.jsx("p",{className:"mt-3",children:e("acceptInvitation.verifying")})]})})})})}):L?s.jsx("div",{className:"bg-light min-vh-100 d-flex flex-row align-items-center",children:s.jsx(x,{children:s.jsx(h,{className:"justify-content-center",children:s.jsx(f,{md:6,children:s.jsx(S,{children:s.jsxs(k,{className:"text-center p-5",children:[s.jsx(m,{icon:O,size:"4xl",className:"text-success mb-3"}),s.jsx("h3",{children:e("acceptInvitation.success.title",{businessName:(N=a==null?void 0:a.businesses)==null?void 0:N.name})}),s.jsx("p",{className:"text-muted",children:e("acceptInvitation.success.accountCreated")}),s.jsx("p",{className:"text-muted",children:e("acceptInvitation.success.redirecting")}),s.jsx(u,{size:"sm",className:"mt-3"})]})})})})})}):s.jsx("div",{className:"bg-light min-vh-100 d-flex flex-row align-items-center",children:s.jsx(x,{children:s.jsx(h,{className:"justify-content-center",children:s.jsx(f,{md:6,children:s.jsxs(S,{children:[s.jsx(Q,{children:s.jsx("h4",{className:"mb-0",children:e("acceptInvitation.title")})}),s.jsxs(k,{className:"p-4",children:[p&&s.jsx(J,{color:"danger",dismissible:!0,children:p}),p&&s.jsx(P,{color:"primary",className:"mt-3",active:!0,tabIndex:-1,onClick:()=>j(C.login),disabled:o,children:e("acceptInvitation.buttons.loginPage")}),a&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"mb-4",children:[s.jsxs("p",{className:"text-muted mb-2",children:[e("acceptInvitation.invitation.youAreInvited")," ",s.jsx("strong",{children:(b=a.businesses)==null?void 0:b.name})]}),s.jsxs("div",{className:"bg-light p-3 rounded",children:[s.jsxs("p",{className:"mb-1",children:[s.jsx(m,{icon:W,className:"me-2"}),s.jsxs("strong",{children:[a.first_name," ",a.last_name]})]}),s.jsx("p",{className:"mb-0 text-muted",children:a.email})]})]}),s.jsxs(K,{onSubmit:B,children:[s.jsxs("div",{className:"mb-3",children:[s.jsxs(I,{htmlFor:"password",children:[e("acceptInvitation.invitation.createPassword")," *"]}),s.jsxs("div",{className:"input-group",children:[s.jsx("span",{className:"input-group-text",children:s.jsx(m,{icon:F})}),s.jsx(y,{type:"password",id:"password",placeholder:e("acceptInvitation.invitation.passwordPlaceholder"),value:c.password,onChange:r=>w("password",r.target.value),required:!0,disabled:o})]})]}),s.jsxs("div",{className:"mb-4",children:[s.jsxs(I,{htmlFor:"confirmPassword",children:[e("acceptInvitation.invitation.confirmPassword")," *"]}),s.jsxs("div",{className:"input-group",children:[s.jsx("span",{className:"input-group-text",children:s.jsx(m,{icon:F})}),s.jsx(y,{type:"password",id:"confirmPassword",placeholder:e("acceptInvitation.invitation.confirmPasswordPlaceholder"),value:c.confirmPassword,onChange:r=>w("confirmPassword",r.target.value),required:!0,disabled:o})]})]}),s.jsx(P,{type:"submit",color:"primary",className:"w-100",disabled:o,children:o?s.jsxs(s.Fragment,{children:[s.jsx(u,{size:"sm",className:"me-2"}),e("acceptInvitation.buttons.creating")]}):e("acceptInvitation.buttons.acceptAndCreate")})]})]})]})]})})})})})};export{os as default};
